---
// src/pages/blog/index.astro
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";
import BlogIndexShell from "../../components/blog/BlogIndexShell.astro";
import { formatDate } from "../../utils/blog";

const base = import.meta.env.BASE_URL || "/";
const posts = (await getCollection("blog")).filter((p) => (import.meta.env.PROD ? !p.data.draft : true)).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
const canonicalUrl = new URL(`${base}blog/`, Astro.site).toString();
---

<BlogIndexShell pageTitle="Blog" pageDescription="Posts & notes" url={canonicalUrl}>
  <header class="mt-10 space-y-3 opacity-0 intersect:opacity-100 intersect:duration-700 intersect:animate-in intersect:slide-in-from-top-10">
    <!-- icon + title on same line -->
    <div class="flex items-center gap-4">
      <a href={`${base}`} aria-label="Home" class="inline-flex items-center justify-center text-neutral-400 hover:text-sky-300 transition-colors group">
        <svg class="w-5 h-5 translate-y-[2px] transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </a>

      <h1 class="text-4xl sm:text-5xl font-black tracking-tighter leading-none">
        <span class="text-sky-400">#</span> BLOG
      </h1>
    </div>

    <!-- indent to match start of the title (w-5 + gap-4 = 20px + 16px = 36px => pl-9) -->
    <p class="pl-9 text-neutral-400 font-jetbrains font-normal"> Notes, builds, and dev write-ups. </p>
  </header>

  {
    posts.length === 0 ? (
      <div class="text-center py-16">
        <p class="text-neutral-500 font-jetbrains">No posts yet. Check back soon!</p>
      </div>
    ) : (
      <section class="flex flex-col gap-3.5">
        {posts.map((post, index) => (
          <a href={`${base}blog/${post.id.replace(/\.(md|mdx)$/, "")}/`} class="group relative flex items-center gap-4 rounded-xl border border-neutral-800/60 bg-gradient-to-r from-neutral-900/80 via-neutral-900/40 to-neutral-800/20 backdrop-blur-sm px-5 py-4 transition-all duration-300 hover:border-sky-500/60 hover:bg-neutral-900/90 hover:shadow-lg hover:shadow-sky-500/10 hover:-translate-y-0.5 opacity-0 intersect:opacity-100 intersect:duration-700 intersect:animate-in intersect:slide-in-from-bottom-6" style={`animation-delay: ${index * 50}ms`}>
            <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-sky-500/0 via-sky-500/5 to-cyan-500/0 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />

            <span class="relative flex h-12 w-12 shrink-0 items-center justify-center rounded-lg bg-gradient-to-br from-neutral-900 to-neutral-800/50 text-sky-300 border border-neutral-800/50 group-hover:border-sky-500/30 group-hover:bg-gradient-to-br group-hover:from-sky-600/20 group-hover:to-cyan-600/10 group-hover:text-sky-200 group-hover:shadow-lg group-hover:shadow-sky-500/20 transition-all duration-300">
              <Icon name="mdi:file-document-outline" class="text-2xl" />
            </span>

            <span class="relative flex-1 text-left min-w-0">
              <span class="block text-base font-semibold leading-tight text-white group-hover:text-sky-50 transition-colors">{post.data.title}</span>
              <span class="block text-xs text-neutral-400 mt-1 line-clamp-1 group-hover:text-neutral-300 transition-colors">{post.data.description}</span>
              <span class="flex flex-wrap items-center gap-2 mt-2 text-xs text-neutral-500">
                <span>{formatDate(post.data.pubDate)}</span>
                {post.data.tags?.slice(0, 2).map((t: string) => (
                  <span class="text-sky-400/70">#{t}</span>
                ))}
              </span>
            </span>

            <span class="relative text-neutral-600 group-hover:text-sky-300 transition-all duration-300 group-hover:translate-x-1">
              <Icon name="mdi:arrow-right" class="text-xl" />
            </span>
          </a>
        ))}
      </section>
    )
  }
</BlogIndexShell>
