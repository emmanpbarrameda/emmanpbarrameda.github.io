---
// src/components/blog/BlogPostShell.astro
import { infos } from "../../data/infos.js";
import Footer from "../footer/footer.astro";
import Background from "../common/background.astro";
import MetaTags from "../common/meta-tags.astro";
import BackToTop from "../common/back-to-top.astro";
import { formatDate } from "../../utils/blog";
import clientGuards from "../../layouts/main-layout.js?raw";

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  tags?: string[];
  url?: string;
}

const { title, description, pubDate, tags = [], url } = Astro.props;
const base = import.meta.env.BASE_URL || "/";
---

<!doctype html>
<html lang="en">
  <head>
    <MetaTags title={`${title} | ${infos.subname} Blog`} description={description} url={url} />
    <title>{title} | {infos.subname}</title>
    <meta name="description" content={description} />
  </head>

  <body class="relative min-h-screen bg-neutral-950 text-white overflow-x-hidden" oncontextmenu="return false;">
    <Background />

    <!-- BLUR -->
    <div class="pointer-events-none fixed inset-0 z-0 overflow-hidden">
      <div class="absolute -top-40 -right-40 h-96 w-96 rounded-full bg-sky-500/5 blur-3xl"></div>
      <div class="absolute -bottom-40 -left-40 h-96 w-96 rounded-full bg-cyan-500/5 blur-3xl"></div>
    </div>

    <main class="relative z-10 mx-auto min-h-screen max-w-screen-xl px-4 py-12 sm:py-16">
      <div class="grid gap-10 lg:grid-cols-[240px_minmax(0,1fr)_200px]">
        <!-- DESKTOP: TOC -->
        <aside class="hidden lg:block">
          <div class="sticky top-24 rounded-lg border border-neutral-800/50 bg-neutral-900/40 backdrop-blur-sm p-4">
            <a href={`${base}blog/`} class="flex items-center gap-2 text-sm text-neutral-400 hover:text-sky-300 transition-colors group mb-4">
              <svg class="w-4 h-4 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              Back to Menu
            </a>
            <div class="mb-4 pb-2 border-b border-neutral-800/40 text-xs uppercase tracking-[0.3em] text-neutral-500"> On This Page </div>
            <nav id="blog-toc" class="space-y-2 text-sm max-h-[65vh] overflow-y-auto"></nav>

            <div class="mt-4 pt-3 border-t border-neutral-800/40 flex items-center justify-between">
              <button onclick="window.print()" class="flex items-center gap-2 text-xs text-neutral-500 hover:text-sky-300 transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                </svg>
                Print
              </button>

              <button type="button" data-share-post class="flex items-center gap-2 text-xs text-neutral-500 hover:text-sky-300 transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                </svg>
                Share
              </button>
            </div>
          </div>
        </aside>
        <script src={`${base}js/blog-toc.js`} defer></script>

        <!-- Main article -->
        <div class="min-w-0">
          <header class="opacity-0 intersect:opacity-100 intersect:duration-700 intersect:animate-in intersect:slide-in-from-top-10">
            <!-- MOBILE: Back -->
            <a href={`${base}blog/`} class="lg:hidden inline-flex items-center gap-2 text-sm text-neutral-400 hover:text-sky-300 transition-colors group">
              <svg class="w-4 h-4 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              Back to Menu
            </a>

            <h1 class="mt-6 text-4xl sm:text-5xl font-black tracking-tighter">
              <span class="text-sky-400">#</span>
              {title}
            </h1>

            <p class="mt-3 text-neutral-400">{description}</p>

            <div class="mt-4 flex flex-wrap items-center gap-3 text-xs text-neutral-500">
              <span class="inline-flex items-center rounded-full border border-neutral-800/60 bg-neutral-900/40 px-3 py-1">
                {formatDate(pubDate)}
              </span>

              {
                tags.length > 0 && (
                  <div class="flex flex-wrap gap-2">
                    {tags.map((t: string) => (
                      <span class="rounded-full border border-sky-500/20 bg-sky-500/5 px-3 py-1 text-sky-200/90">#{t}</span>
                    ))}
                  </div>
                )
              }
            </div>

            <hr class="mt-8 border-neutral-800/60" />
          </header>

          <!-- MOBILE: TOC -->
          <div class="lg:hidden mb-6 rounded-lg border border-neutral-800/50 bg-neutral-900/40 backdrop-blur-sm">
            <details>
              <summary class="flex items-center justify-between p-4 cursor-pointer text-sm text-neutral-400 hover:text-sky-300 transition-colors">
                <span class="flex items-center gap-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path>
                  </svg>
                  Table of Contents
                </span>
                <svg class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </summary>
              <nav id="blog-toc-mobile" class="px-4 pb-4 space-y-2 text-sm max-h-[50vh] overflow-y-auto"></nav>
            </details>
          </div>

          {/* Markdown (md files inside of src\content\blog) content */}
          <article class="blog-content font-jetbrains font-light text-neutral-400 [&>p]:text-justify">
            <slot />
          </article>

          <!-- Post actions -->
          <div class="mt-8 pt-6 border-t border-neutral-800/40 flex items-center justify-between">
            <a href="#" class="flex items-center gap-2 text-sm text-neutral-500 hover:text-sky-300 transition-colors">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
              </svg>
              Back to Top
            </a>

            <button type="button" data-share-post class="flex items-center gap-2 text-sm text-neutral-500 hover:text-sky-300 transition-colors">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
              </svg>
              Share
            </button>
          </div>

          <BackToTop />
          <script is:inline set:html={clientGuards} />
          <Footer />
        </div>
      </div>
    </main>

    <style is:global>
      .blog-content h1 {
        @apply text-3xl font-black text-white mt-8 mb-4 tracking-tighter;
      }
      .blog-content h2 {
        @apply text-2xl font-bold text-white mt-8 mb-4;
      }
      .blog-content h3 {
        @apply text-xl font-bold text-white mt-6 mb-3;
      }
      .blog-content p {
        @apply text-neutral-400 mb-4 leading-relaxed;
      }
      .blog-content a {
        @apply text-sky-400 hover:text-sky-300 underline underline-offset-2 transition-colors;
      }
      .blog-content strong {
        @apply font-bold text-neutral-200;
      }
      .blog-content ul,
      .blog-content ol {
        @apply my-4 ml-6 space-y-2 text-neutral-400;
      }
      .blog-content ul {
        @apply list-disc;
      }
      .blog-content ol {
        @apply list-decimal;
      }
      .blog-content li {
        @apply pl-2;
      }
      .blog-content blockquote {
        @apply border-l-4 border-sky-500/50 pl-4 my-4 italic text-neutral-500;
      }
      .blog-content code {
        @apply bg-neutral-800/50 text-sky-300 px-1.5 py-0.5 rounded text-sm font-mono;
      }
      .blog-content pre {
        @apply bg-neutral-900/80 border border-neutral-800/60 rounded-lg p-4 my-4 overflow-x-auto;
      }
      .blog-content pre code {
        @apply bg-transparent p-0 text-sm;
      }
      .blog-content img {
        @apply rounded-lg border border-neutral-800/60 my-6;
      }
      .blog-content hr {
        @apply border-neutral-800/60 my-8;
      }

      .blog-content :is(h1, h2, h3, h4, h5, h6) {
        position: relative;
        scroll-margin-top: 110px;
      }
      .blog-content .heading-anchor-link {
        position: absolute;
        left: -1.8rem;
        top: 50%;
        transform: translateY(-50%);
        opacity: 0;
        text-decoration: none;
        color: rgb(56 189 248 / 0.85);
        font-weight: 700;
        padding: 0 0.25rem;
      }
      .blog-content :is(h1, h2, h3, h4, h5, h6):hover .heading-anchor-link {
        opacity: 1;
      }

      :target {
        animation: flash 1s ease-out 2;
      }
      @keyframes flash {
        0% {
          background: rgba(56 189 248 / 0.8);
        }
        100% {
          background: transparent;
        }
      }

      details[open] > summary svg:last-child {
        transform: rotate(180deg);
      }
    </style>
    <script src={`${base}js/blog-heading-copy-links.js`} defer></script>
    <script src={`${base}js/blog-share.js`} defer></script>
  </body></html
>
