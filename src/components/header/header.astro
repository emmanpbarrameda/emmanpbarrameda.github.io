---
// file: src\components\header\header.astro
import MenuIcon from "../icons/menu-icon.astro";
import HeaderLink from "./header-link.astro";

const isHome = Astro.url.pathname === "/";
---

{isHome && <div id="scroll-watcher" class="h-px" data-scroll-watcher />}

<header
  id="header"
  data-home={isHome ? "true" : "false"}
  class={`transition-transparent fixed w-full left-0 top-0 z-30 flex flex-col items-center justify-center py-2 font-jetbrains md:flex-row
  ${isHome ? "bg-neutral-900 md:bg-transparent md:data-[moving]:bg-neutral-900" : "bg-neutral-900"}`}
>
  <!-- mobile -->
  <button id="toggle-menu" class="flex items-center gap-1 min-[900px]:hidden" aria-label="Toggle menu">
    <span aria-hidden="true" class="text-2xl leading-[1] text-neutral-500">{""}</span>
    <MenuIcon width={48} height={48} />
    <span aria-hidden="true" class="text-2xl leading-[1] text-neutral-500">{""}</span>
  </button>

  <nav id="menu" class="group hidden items-center data-[toggle]:flex data-[toggle]:flex-col min-[900px]:flex min-[900px]:flex-row min-[900px]:data-[toggle]:flex-row">
    <span aria-hidden="true" class="hidden text-2xl leading-[1] text-neutral-500 min-[900px]:inline-block">{"<?"}</span>
    <HeaderLink href="#home" text="main" />
    <HeaderLink href="#about-me" text="getAbout" />
    <HeaderLink href="#projects" text="getProjects" />
    <HeaderLink href="#credentials" text="getCredentials" />
    <HeaderLink href="#certificates" text="getCertificates" />
    <HeaderLink href="/dev-notes" text="getDevNotes" />
    <HeaderLink href="#contact" text="getInTouch" />
    <span aria-hidden="true" class="hidden text-2xl leading-[1] text-neutral-500 min-[900px]:inline-block">{"?>"}</span>
  </nav>
</header>

<script>
  const $button = document.getElementById("toggle-menu");
  const $menu = document.getElementById("menu");
  const $header = document.getElementById("header");

  // toggle menu works everywhere
  if ($button && $menu) {
    $button.addEventListener("click", () => {
      $menu.toggleAttribute("data-toggle");
    });
  }

  // ONLY run transparent-on-top behavior
  const isHome = $header?.dataset.home === "true";
  const $scrollWatcher = document.getElementById("scroll-watcher");

  if (isHome && $header && $scrollWatcher) {
    const menuObserver = new IntersectionObserver((entries) => {
      $header.toggleAttribute("data-moving", !entries[0].isIntersecting);
    });

    menuObserver.observe($scrollWatcher);
  } else if ($header) {
    // non-home pages, solid header
    $header.setAttribute("data-moving", "");
  }
</script>
